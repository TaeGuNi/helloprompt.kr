---
layout: /src/layouts/Layout.astro
title: "遅すぎるSQLクエリ、3秒でチューニングする秘訣"
author: "Zzabbis"
date: "2026-02-04"
updatedDate: "2026-02-04"
category: "コーディング/開発"
description: "複雑で非効率的なSQLクエリを分析して性能を最適化し、インデックスを推薦してくれるプロンプトです。"
tags: ["SQL", "DBチューニング", "クエリ最適化", "データベース"]
---

# 📝 遅すぎるSQLクエリ、3秒でチューニングする秘訣

**🎯 推奨対象:** 誰でも
**⏱️ 所要時間:** 5分
**🤖 推奨モデル:** すべてのAIモデル

| 難易度  |    効果    |  活用度   |
| :-----: | :--------: | :-------: |
| ⭐⭐☆☆☆ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐☆ |

_「データが少し溜まっただけで照会するのに5秒かかります...」_

最初は速かったクエリがデータが増えるにつれて亀になります。
実行計画(Explain Plan)を見ても黒いのは字で白いのは背景で途方に暮れていましたか？
AIにクエリを見せれば非効率的な部分を見つけ出し、魔法のようなインデックス推薦までしてくれます。

---

## ⚡️ 3行要約 (TL;DR) {#tl-dr}

1. 非効率的なジョイン(Join)とサブクエリ改善
2. 必要なインデックス(Index)推薦
3. 可読性の良いモダンSQL文法で再作成

---

## 🚀 解決策：「SQLクエリチューナー」

### 🥉 Basic Version (基本形)

素早く結果だけが必要な場合に使用してください。

> **役割:** あなたは20年の経歴を持つ首席DBA(Database Administrator)でありSQLチューニング専門家です。
> **リクエスト:** 複雑で非効率的なSQLクエリを分析して性能を最適化し、インデックスを推薦してくれるプロンプトを作成してください。

<br>

### 🥇 Pro Version (専門家形)

詳細なクオリティが必要な場合に使用してください。

以下の**PROMPT**内容をコピーして使用してください。

> **役割:** あなたは20年の経歴を持つ首席DBA(Database Administrator)でありSQLチューニング専門家です。
>
> **状況:** 私のアプリケーションで使用するSQLクエリがデータ量が多くなるにつれて性能低下を引き起こしています。
>
> **タスク:**
> 以下に提供されたSQLクエリを分析して次の作業を実行してください:
>
> 1. **問題点診断:** 現在のクエリで性能低下を誘発する可能性のある部分(Full Table Scanなど)を指摘してください。
> 2. **クエリ最適化:** 同様の結果を返すがより効率的に動作するクエリに書き直してください。
> 3. **インデックス推薦:** クエリ性能を最大化するためにどのカラムにインデックスをかけるべきか`CREATE INDEX`構文で提案してください。
>
> **使用中のDB:** `[MySQL / PostgreSQL / Oracle / MS-SQL]`
>
> **対象クエリ:**

> [ここに遅いクエリを貼り付けてください]

> **制約事項:**
>
> - 既存クエリの結果データセットは絶対に変更されてはいけません。
> - なぜ速くなったのか実行原理を簡単に説明してください。

---

## 🧬 プロンプト解剖 (Why it works?) {#why-it-works}

---

## 📊 証明: Before & After

### ❌ Before (入力クエリ)

```sql
SELECT * FROM users
WHERE id IN (SELECT user_id FROM orders WHERE price > 10000);
```

_問題点: サブクエリが各行ごとに実行される可能性があります(Dependent Subquery)。_

### ✅ After (結果)

**最適化されたクエリ (JOIN 使用):**

```sql
SELECT DISTINCT u.*
FROM users u
INNER JOIN orders o ON u.id = o.user_id
WHERE o.price > 10000;
```

**推薦インデックス:**

```sql
CREATE INDEX idx_orders_price_userid ON orders(price, user_id);
```

_説明: サブクエリをJOINに変更して最適化し、`price`でフィルタリング後`user_id`でジョインするように複合インデックスを生成しました。_

---

## 🎯 結論

「チューニングは芸術だ」という言葉がありますが、今はAIの助けを借りられる「科学」です。
遅いクエリのせいで苦しまず、AI DBAに無料コンサルティングを受けてみてください！ 🍷
